{"ts":1358859334266,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"\r\n/**\r\n * Module dependencies.\r\n */\r\n\r\nvar express = require('express')\r\n  , routes = require('./routes')\r\n  , user = require('./routes/user')\r\n  , http = require('http')\r\n  , path = require('path')\r\n  , mysql = require('mysql')\r\n  , fs = require('fs')\r\n  , ejs = require('ejs');\r\n\r\nvar app = express();\r\n\r\nvar con = mysql.createConnection({\r\n    host: 'instance37078.db.xeround.com',\r\n    port: '5291',\r\n\tuser: 'cherry',\r\n\tpassword: '1234'\r\n});\r\n\r\napp.configure(function(){\r\n  app.set('port', process.env.PORT);\r\n  app.set('views', __dirname + '/views');\r\n  app.set('view engine', 'jade');\r\n  app.use(express.favicon());\r\n  app.use(express.logger('dev'));\r\n  app.use(express.bodyParser());\r\n  app.use(express.methodOverride());\r\n  app.use(app.router);\r\n  app.use(express.static(path.join(__dirname, 'public')));\r\n});\r\n\r\napp.configure('development', function(){\r\n  app.use(express.errorHandler());\r\n});\r\n\r\napp.get('/', routes.index);\r\napp.get('/users', user.list);\r\napp.get('/product', function (req, res) {\r\n    res.render('product', {\r\n\t\tlayout: '/layout.jade',\r\n\t\ttitle: 'Product Page'\r\n\t});\r\n});\r\n\r\n// List\r\napp.get('/list', function(req, res){\r\n    fs.readFile('public/List.html', 'utf8', function(error, data){\r\n\t\tcon.query('USE test');\r\n\t\tcon.query('SELECT * FROM PRODUCTS ORDER BY 1', function(error, result, fields){\r\n\t\t\tres.writeHead(200, {'Content-Type': 'text/html'});\r\n            res.end(ejs.render(data, {\r\n\t\t\t\tdata: result\r\n\t\t\t}));\r\n\t\t});\r\n\t});\r\n});\r\n\r\n// Do Delete\r\napp.get('/delete/:id', function(req, res){\r\n\tcon.query('USE test');\r\n\tcon.query('DELETE FROM PRODUCTS WHERE ID = ?', [req.params.id]);\r\n\t\r\n\tres.writeHead(302, {'Location' : '/list'});\r\n\tres.end();\r\n});\r\n\r\n// Insert Page\r\napp.get('/insert', function (req, res){\r\n\tfs.readFile('public/Insert.html', 'utf8', function(error, data){\r\n\t\tres.writeHead(200, {'Content-Type' : 'text/html'});\r\n\t\tres.end(data);\r\n\t});\r\n});\r\n\r\n// Do Insert\r\napp.post('/insert', function(req, res){\r\n\tvar body = req.body;\r\n\t\r\n\tcon.query('USE test');\r\n\tcon.query('INSERT INTO PRODUCTS (name, modelnumber, series) VALUES (?, ?, ?)', [body.name, body.modelnumber, body.series]);\r\n\t\r\n\tres.writeHead(302, {'Location' : '/list'});\r\n\tres.end();\r\n});\r\n\r\n// Edit Page\r\napp.get('/edit/:id', function(req, res){\r\n\tfs.readFile('public/Edit.html', 'utf8', function(error, data){\r\n\t\tcon.query('USE test');\r\n\t\tcon.query('SELECT * FROM PRODUCTS WHERE ID = ?', [req.params.id], function(error, result){\r\n\t\t\tres.writeHead(200, {'Content-Type': 'text/html'});\r\n\t\t\tres.end(ejs.render(data, {\r\n\t\t\t\tdata: result[0]\r\n\t\t\t}));\r\n\t\t});\r\n\t});\r\n});\r\n\r\n// Do Edit\r\napp.post('/Edit/:id', function(req, res){\r\n\tvar body = req.body;\r\n\t\r\n\tcon.query('USE test');\r\n\tcon.query('UPDATE PRODUCTS SET NAME = ?, MODELNUMBER = ?, SERIES = ? WHERE ID = ?', [body.name, body.modelnumber, body.series, req.params.id]);\r\n\t\r\n\tres.writeHead(302, {'Location' : '/list'});\r\n\tres.end();\r\n});\r\n\r\nhttp.createServer(app).listen(process.env.PORT, process.env.IP, function(){\r\n  console.log(\"Express server listening on port \" + process.env.PORT);\r\n});\r\n"]],"start1":0,"start2":0,"length1":0,"length2":3051}]],"length":3051}
